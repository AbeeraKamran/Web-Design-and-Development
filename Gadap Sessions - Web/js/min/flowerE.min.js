(function(){var t,e,i,n,o,s,a,r,h,d,l,f,c,u,m,p,x,g=function(t,e){return function(){return t.apply(e,arguments)}};for(e=function(){function t(t){var e,i,n,o;this.options=null!=t?t:{},this.defaults={offsetRotation:0,offsetScale:1,offsetX:0,offsetY:0,radius:1100,slices:12,zoom:1},i=this.defaults;for(e in i)o=i[e],this[e]=o;n=this.options;for(e in n)o=n[e],this[e]=o;null==this.domElement&&(this.domElement=document.createElement("canvas")),null==this.context&&(this.context=this.domElement.getContext("2d")),null==this.image&&(this.image=document.createElement("img"))}return t.prototype.HALF_PI=Math.PI/2,t.prototype.TWO_PI=2*Math.PI,t.prototype.draw=function(){var t,e,i,n,o,s,a;for(this.domElement.width=this.domElement.height=2*this.radius,this.context.fillStyle=this.context.createPattern(this.image,"repeat"),s=this.zoom*(this.radius/Math.min(this.image.width,this.image.height)),a=this.TWO_PI/this.slices,t=this.image.width/2,o=[],i=e=0,n=this.slices;n>=0?n>=e:e>=n;i=n>=0?++e:--e)this.context.save(),this.context.translate(this.radius,this.radius),this.context.rotate(i*a),this.context.beginPath(),this.context.moveTo(-.5,-.5),this.context.arc(0,0,this.radius,a*-.51,.51*a),this.context.lineTo(.5,.5),this.context.closePath(),this.context.rotate(this.HALF_PI),this.context.scale(s,s),this.context.scale([-1,1][i%2],1),this.context.translate(this.offsetX-t,this.offsetY),this.context.rotate(this.offsetRotation),this.context.scale(this.offsetScale,this.offsetScale),this.context.fill(),o.push(this.context.restore());return o},t}(),t=function(){function t(t,e,i){var n;this.callback=t,this.context=null!=e?e:document,this.filter=null!=i?i:/^image/i,this.onDrop=g(this.onDrop,this),n=function(t){return t.stopPropagation(),t.preventDefault()},this.context.addEventListener("dragleave",n),this.context.addEventListener("dragenter",n),this.context.addEventListener("dragover",n),this.context.addEventListener("drop",this.onDrop,!1)}return t.prototype.onDrop=function(t){var e,i;return t.stopPropagation(),t.preventDefault(),e=t.dataTransfer.files[0],this.filter.test(e.type)?(i=new FileReader,i.onload=function(t){return function(e){return"function"==typeof t.callback?t.callback(e.target.result):void 0}}(this),i.readAsDataURL(e)):void 0},t}(),a=new Image,a.onload=function(){return function(){return r.draw()}}(this),a.src="https://s3.amazonaws.com/websiteimagery/kalair_4e.jpg",r=new e({image:a,slices:20}),r.domElement.style.position="fixed",r.domElement.style.overflow="hidden",r.domElement.style.marginLeft=-r.radius+"px",r.domElement.style.marginTop=-r.radius+"px",r.domElement.style.left="50%",r.domElement.style.top="50%",document.body.appendChild(r.domElement),n=new t(function(t){return r.image.src=t}),m=r.offsetX,p=r.offsetY,u=r.offsetRotation,l=function(){return function(t){var e,i,n,o,s,a;return e=window.innerWidth/2,i=window.innerHeight/2,n=t.pageX/window.innerWidth,o=t.pageY/window.innerHeight,s=n-.5,a=o-.5,m=s*r.radius*-2,p=a*r.radius*2,u=Math.atan2(a,s)}}(this),window.addEventListener("mousemove",l,!1),f={interactive:!0,ease:.01},(x=function(){return function(){var t,e;return f.interactive&&(t=u-r.offsetRotation,e=Math.atan2(Math.sin(t),Math.cos(t)),r.offsetX+=(m-r.offsetX)*f.ease,r.offsetY+=(p-r.offsetY)*f.ease,r.offsetRotation+=(e-r.offsetRotation)*f.ease,r.draw()),setTimeout(x,1e3/60)}}(this))(),o=new dat.GUI,o.add(r,"zoom").min(.25).max(2),o.add(r,"slices").min(6).max(32).step(2),o.add(r,"radius").min(200).max(500),o.add(r,"offsetX").min(-r.radius).max(r.radius).listen(),o.add(r,"offsetY").min(-r.radius).max(r.radius).listen(),o.add(r,"offsetRotation").min(-Math.PI).max(Math.PI).listen(),o.add(r,"offsetScale").min(.5).max(4),o.add(f,"interactive").listen(),o.close(),d=function(){return function(){return r.domElement.style.marginLeft=-r.radius+"px",r.domElement.style.marginTop=-r.radius+"px",f.interactive=!1,r.draw()}}(this),c=o.__controllers,s=0,h=c.length;h>s;s++)i=c[s],"interactive"!==i.property&&i.onChange(d)}).call(this);